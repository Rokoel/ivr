# Шевелев Валентин - "Шахматы для троих"
# Пользовательские сценарии

### Группа: 10 - МИ - 2
### Электронная почта: rokoelvel@gmail.com
### VK: www.vk.com/rokoelakk
### TG: @rokoel
### Discord: Rokoel#9384


### [ Сценарий 1 - Использование сайта неавторизованным пользователем ]

1. Пользователь может просмотреть главную страницу сайта с информацией и выбрать, куда перейти далее
2. Если пользователь выберет страницу с правилами, то необходимо будет перекинуть его на страницу, содержащую правила тройных шахмат
3. Если пользователь выберет страницу с информацией о рейтинговой системе и другой информации о системе на сайте, то необходимо будет перекинуть его на эту страницу
4. Если пользователь выберет страницу со списком статей (о новостях на сайте), необходимо будет перекинуть его на эту страницу
5. Если пользователь выберет страницу с дебютами, загруженными другими пользователями, то необходимо перекинуть его на эту страницу
6. Если пользователь нажмет на кнопку авторизации, необходимо будет перейти к сценарию 2
7. Если пользоваетль нажмет на кнопку "Играть", необходимо будет перейти к сценарию 2, а после его завершения - к сценарию 4

### [ Сценарий 2 - Авторизация пользователя ]

1. Перед пользователем отображено окно авторизации, она происходит через ВКонтакте
1. Пользователь нажимает на кнопку "Войти/ Зарегестрироваться через ВКонтакте"
2. Далее пользователя перекидывает на страницу входа ВКонтакте, после успешной авторизации в котором и выдачи всех разрешений, пользователя возвращает на наш сайт, передавая также и информацию об этом пользователе, но уже во ВКонтакте
3. Если пользователь с таким ай ди ВКонтакте уже существует у нас в БД, то перекидываем на главную страницу сайта, с учетом того, что пользователь вошел в аккаунт
4. Если пользователь с таким ай ди ВКонтакте еще не существует у нас в БД, перекилываем на страницу регистрации
5. На странице регистрация мы просим пользователя ввести никнейм на сайте, добавить описание профиля и загрузить аватар пользователя
6. В дальнейшем эти три параметра можно изменять в редактировании профиля
7. После успешной регистрации предлагаем подписаться на сообщения сообщества в ВК (чтобы разрешить сообщения) и перекидываем на главную страницу сайта, с учетом того, что пользователь вошел в аккаунт

### [ Сценарий 3 - Использование сайта авторизованным пользователем ]

1. Если авторизованный пользователь выбирает ссылку на страницу, не требующую авторизации, то далее выполняется соответствующая часть сценария 1
2. Если пользователь выбирает кнопку "Профиль", то необходимо перейти к пункту 6 сценария 2
3. Если пользователь выбирает кнопку "Играть", необходимо перейти к сценарию 4
4. Если пользователь выбирает кнопку "Добавить дебют" на странице добавления дебютов, необходимо перейти к сценарию 5
5. Если пользователь нажимает на конкретную игру в истории игр, необходимо перейти к сценарию 6
6. Если пользователь нажимает на кнопку "Удалить аккаунт", необходимо удалить аккаунт
7. Если пользователь нажимает кнопку "Выйти", то нужно выйти из аккаунта и перейти к сценарию 1

### [ Сценарий 4 - Игра 1vs1vs1 ]

1. Подбираем двух самых близких по рейтингу соперников, которые сейчас тоже ищут игру
2. Случайно распределяем порядок ходов (т. е. роли игрока за "Белых", "Черных" и "Красных")
3. Отрисовываем доску в соответствии с выбранной темой и запускаем таймер первого игрока; далее при смене хода запускаем и останавливаем таймеры соответствующих игроков
4. Переходим к сценарию 7
5. Если игрок получил мат или пат, высвечивем уведомление; оно содержит кнопку "Выйти" и кнопку "Досмотреть", а его рейтинг изменяется согласно его результату
6. При нажатии на кнопку "Досмотреть", ход игрока просто пропускается, однако все остальное остается также
7. Если игрок нажал "предложить ничью", все игроки получают об этом мини-уведомление с возможностью согласиться и отказаться; в случае отказа хотя бы одного из игроков, еще не закончивших игру, предложение отклоняется, в противном случае игра заканчивается ничьей
8. Если все игроки, кроме одного, получили пат, игра заканчивается ничьей; если второй выбывший игрок получил пат, то оба последний игрока имеют результат "ничья"; если второй выбывший игрок получил мат, то оставшийся игрок объявляется победителем

### [ Сценарий 5 - Добавление и модификация дебюта ]

1. Если пользователь открывает конкретный дебют и выбирает "Добавить ответвление", ему предоставляется возможность добавить ходы в партию, как в обычной партии, начиная с определенного места в партии
2. Затем пользователь дает название вариации
3. Если пользователь нажимает "Добавить дебют", ему предоставляется возможность добавить ходы в партию, как в обычной партии, и менять их по своему усмотрению
4. Затем пользователь дает название дебюту
5. Если пользователь нажимает "Список моих дебютов", ему открывается список созданных им вариаций или дебютов
6. Далее пользователь может удалить, просмотреть или отредактировать дебют; при нажатии на кнопку "Просмотреть дебют", дебют открывается в сценарии 6
7. Если пользователь нажимает кнопку лайка на каком-либо дебюте, он может увеличить репутацию этого дебюта (и его автора) на единицу

### [ Сценарий 6 - Просмотр истории партии ]

1. Отрисовываем доску в соответствии с выбранной темой в начальной позиции (все фигуры на начальных местах)
2. Если пользователь нажимает на стрелочки, листаем на один зод вперед или один ход назад соответственно
3. Если пользователь нажимает кнопку "play", начинает проигрываться последовательность ходов, а пользователь может контроллировать скорость
4. Если пользователь нажимает кнопку "play in real time", начинает проигрываться последовательность ходов, с той скоростью, с которой они были сделаны в игре
5. Аналогично при нажатии кнопки "stop", проигрывание партии прекращается
6. Также игрок может загрузить другую партию, если последовательность ходов созранена в текстовый файл, нажав соответствующую кнопку и загрузив этот файл
7. При нажатии на конкретный ход, партия отображает позицию во время этого хода

### [ Сценарий 7 - Обработка хода ]

1. Подробная информация о правилах, в соответствии с которыми происходят проверки на легальность/нелегальность, шах, мат или ничью, есть на [этом сайте](https://greenchess.net/rules.php?v=three-player)
2. Если игрок нажал не на свою фигуру, нажатое поле подсвечивается
3. Если игрок нажал на свою фигуру, то на полях, на которые может пойти фигура, появляются полупрозрачные точки. Проверка полей на легальность учитывает все правила
4. Если пользователь нажал на свою фигуру, а потом на поле, содержащее полупрозрачну точку, происходит ход, информация об этом отправляется на сервер, где сохраняется, а два других игрока получают об этом информацию
5. На сервере также происходит проверка корректности хода на случий попыток неразрешенных манипуляций
6. Если время игрока вышло, о чем ведется учет на сервере, ему отправляется уведомление и ход переходит следующему игроку
7. Если игрок, при переходе к нему хода, оказывается в позиции мата/пата, игроку приходит соответствующее уведомление и ход переходит следующему игроку
8. Игрок может предложить ничью (предложение должно быть принято всеми игроками, чтобы была ничья) и сдаться, нажав на соответствующие кнопки
9. Во время всей партии ведется автоматическая нотация, которая отображается справа от доски;  нотации также ведется учет времени хода
